language: php
env:
  - DRUPAL_VERSION=7.78
php:
  - '7.4'
before_install:
  - cd ..
  - cp -R DrupalSqlSrvCI DrupalCI
install:
  - bash DrupalCI/src/travis/install.sh
  - export PATH="/opt/mssql-tools/bin:$PATH"
before_script:
  - bash DrupalCI/src/travis/build.sh
  - cd drupal-project
script:
  # test mssql version.
  # test php version.
  - test [[ `php --version` == ${TRAVIS_PHP_VERSION}* ]]
  # test apache settings.
  # test drupal version
  - |
    if [ -z $DRUPAL_VERSION ] or [ $DRUPAL_VERSION == "7.x" ] ;
    then
      test [ `git-branch --show-current` == "7.x" ]
    else
      test [ `git describe --tags --exact-match` == $DRUPAL_VERSION ]
    fi
  # integration test, run simpletests.
  - php ./scripts/run-tests.sh --php `which php` "Database (SQL Server)"
